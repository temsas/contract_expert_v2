<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .hidden { display: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 25px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { padding: 10px; width: 100%; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .format-info { background: #e9ecef; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 14px; }
        .update-btn { background: #28a745; margin-left: 10px; }
        .update-btn:hover { background: #218838; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
        .suppliers-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .suppliers-table th, .suppliers-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .suppliers-table th { background: #f8f9fa; font-weight: bold; }
        .suppliers-table tr:hover { background: #f5f5f5; }
        .rating { color: #ffc107; font-weight: bold; }
        .stats-bar { display: flex; justify-content: space-between; background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 14px; color: #6c757d; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üîç –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç</h1>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 44-–§–ó –∏ 223-–§–ó</p>

        <div class="card">
            <h2>–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</h2>
            <div class="format-info">
                <strong>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</strong> PDF, DOC, DOCX
            </div>

            <form id="uploadForm" enctype="multipart/form-data" style="margin-top: 15px;">
                <div class="form-group">
                    <label for="law_type">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–æ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</label>
                    <select id="law_type" name="law_type" required>
                        <option value="44_fz">44-–§–ó</option>
                        <option value="223_fz">223-–§–ó</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contract_file">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç:</label>
                    <input type="file" id="contract_file" name="contract_file"
                           accept=".pdf,.doc,.docx" required>
                </div>

                <button type="submit" id="analyzeBtn">
                    {% if AI_AVAILABLE %}
                        üîç –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç
                    {% else %}
                        ‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                    {% endif %}
                </button>
            </form>
        </div>

        <div id="result" class="card hidden">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h2>
            <div id="analysisResult"></div>
        </div>

        <!-- ======================== -->
        <!-- üì¶ –ú–û–î–£–õ–¨ –ü–û–î–ë–û–†–ê –ü–û–°–¢–ê–í–©–ò–ö–û–í -->
        <!-- ======================== -->
        <div class="card">
            <h2>üì¶ –ü–æ–¥–±–æ—Ä –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏–∑ goszakup.gov.kz</h2>

            <div class="format-info">
                <strong>–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞–ª–∞ goszakup.gov.kz</strong>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="filters-section">
                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
                    <div class="form-group">
                        <label for="purchase_method">–°–ø–æ—Å–æ–± –∑–∞–∫—É–ø–∫–∏:</label>
                        <select id="purchase_method" name="purchase_method" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –∑–∞–∫—É–ø–∫–∏...</option>
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="category">–í–∏–¥ –ø—Ä–µ–¥–º–µ—Ç–∞ –∑–∞–∫—É–ø–∫–∏:</label>
                        <select id="category" name="category" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
                            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </select>
                    </div>

                    <div>
                        <button type="button" id="updateDataBtn" class="update-btn">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="supplierStats" class="stats-bar hidden">
                <div class="stat-item">
                    <div class="stat-value" id="totalSuppliers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uniqueMethods">0</div>
                    <div class="stat-label">–°–ø–æ—Å–æ–±–æ–≤ –∑–∞–∫—É–ø–∫–∏</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uniqueCategories">0</div>
                    <div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentResults">0</div>
                    <div class="stat-label">–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</div>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div id="supplierResult" class="hidden">
                <h3>–¢–û–ü –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h3>
                <div id="loadingMessage" class="hidden">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                <div id="supplierTableContainer">
                    <table class="suppliers-table" id="suppliersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</th>
                                <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                <th>–ö–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</th>
                                <th>–û–±—â–∞—è —Å—É–º–º–∞</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–°–ø–æ—Å–æ–± –∑–∞–∫—É–ø–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody id="supplierTableBody">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="noResults" class="hidden" style="text-align: center; padding: 40px; color: #6c757d;">
                    <h4>ü§∑‚Äç‚ôÇÔ∏è –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</p>
                    <button type="button" onclick="updateSuppliersData()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                        üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å goszakup.gov.kz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentSuppliers = [];
        let debounceTimer;

        // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const resultDiv = document.getElementById('analysisResult');
            const resultCard = document.getElementById('result');

            resultCard.classList.remove('hidden');
            resultDiv.innerHTML = '<p>‚è≥ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞...</p>';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.status === 'success') {
                    let html = `
                        <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ${data.law_type.toUpperCase()}</h3>
                        <p><strong>–§–∞–π–ª:</strong> ${data.filename}</p>
                        <p><strong>–°—Ç–∞—Ç—É—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:</strong> <span style="font-weight: bold; color: ${
                            data.analysis.compliance_status === '—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' ? 'green' :
                            data.analysis.compliance_status === '—á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç' ? 'orange' : 'red'
                        }">${data.analysis.compliance_status}</span></p>
                        <p><strong>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:</strong> ${data.analysis.summary}</p>
                    `;

                    if (data.analysis.issues && data.analysis.issues.length > 0) {
                        html += '<h4>–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</h4><ul>';
                        data.analysis.issues.forEach(issue => {
                            html += `
                                <li style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-left: 4px solid #e74c3c;">
                                    <strong>${issue.article}:</strong> ${issue.issue}
                                    <br><em>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</em> ${issue.recommendation}
                                </li>
                            `;
                        });
                        html += '</ul>';
                    } else {
                        html += '<p style="color: green; font-weight: bold;">‚úÖ –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ</p>';
                    }

                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error}</p>`;
            }
        });

        // ========================
        // üì¶ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –ü–û–î–ë–û–† –ü–û–°–¢–ê–í–©–ò–ö–û–í
        // ========================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeSupplierModule();
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('updateDataBtn').addEventListener('click', async function() {
            await updateSuppliersData();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
        async function initializeSupplierModule() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                await loadPurchaseMethods();
                await loadCategories();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await loadStats();

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
                document.getElementById('purchase_method').addEventListener('change', handleFilterChange);
                document.getElementById('category').addEventListener('change', handleFilterChange);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                await searchSuppliers();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞–∫—É–ø–∫–∏
        async function loadPurchaseMethods() {
            try {
                const response = await fetch('/api/purchase-methods');
                const methods = await response.json();

                const select = document.getElementById('purchase_method');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –∑–∞–∫—É–ø–∫–∏...</option>';

                methods.forEach(method => {
                    const option = document.createElement('option');
                    option.value = method;
                    option.textContent = method;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞–∫—É–ø–∫–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();

                const select = document.getElementById('category');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>';

                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/api/suppliers-stats');
                const stats = await response.json();

                document.getElementById('totalSuppliers').textContent = stats.total_suppliers || 0;
                document.getElementById('uniqueMethods').textContent = stats.unique_methods || 0;
                document.getElementById('uniqueCategories').textContent = stats.unique_categories || 0;

                document.getElementById('supplierStats').classList.remove('hidden');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function handleFilterChange() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                searchSuppliers();
            }, 300); // –ó–∞–¥–µ—Ä–∂–∫–∞ 300–º—Å
        }

        // –ü–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
        async function searchSuppliers() {
            const method = document.getElementById('purchase_method').value;
            const category = document.getElementById('category').value;

            const resultDiv = document.getElementById('supplierResult');
            const loadingMessage = document.getElementById('loadingMessage');
            const tableBody = document.getElementById('supplierTableBody');
            const noResults = document.getElementById('noResults');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loadingMessage.classList.remove('hidden');
            tableBody.innerHTML = '';
            noResults.classList.add('hidden');
            resultDiv.classList.remove('hidden');

            // –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã –æ–±–∞ —Ñ–∏–ª—å—Ç—Ä–∞, –Ω–µ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
            if (!method && !category) {
                loadingMessage.classList.add('hidden');
                noResults.classList.remove('hidden');
                document.getElementById('currentResults').textContent = '0';
                return;
            }

            try {
                const response = await fetch('/suppliers', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        purchase_method: method,
                        category: category,
                        limit: 50 // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç –¥–ª—è –ª—É—á—à–µ–≥–æ UX
                    })
                });

                const data = await response.json();

                // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                loadingMessage.classList.add('hidden');

                if (data.status === 'success' && data.suppliers.length > 0) {
                    currentSuppliers = data.suppliers;
                    renderSuppliersTable(currentSuppliers);
                    document.getElementById('currentResults').textContent = data.suppliers.length;
                    noResults.classList.add('hidden');
                } else {
                    currentSuppliers = [];
                    tableBody.innerHTML = '';
                    document.getElementById('currentResults').textContent = '0';
                    noResults.classList.remove('hidden');
                }
            } catch (err) {
                loadingMessage.classList.add('hidden');
                tableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: red;">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
                document.getElementById('currentResults').textContent = '0';
                noResults.classList.remove('hidden');
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
        function renderSuppliersTable(suppliers) {
            const tableBody = document.getElementById('supplierTableBody');
            tableBody.innerHTML = '';

            suppliers.forEach((supplier, index) => {
                const row = document.createElement('tr');

                // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥—ã –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
                const stars = '‚≠ê'.repeat(Math.floor(supplier.rating)) +
                             (supplier.rating % 1 >= 0.5 ? '¬Ω' : '');

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${supplier.name}</strong></td>
                    <td><span class="rating">${supplier.rating} ${stars}</span></td>
                    <td>${supplier.contracts_count.toLocaleString()}</td>
                    <td>${formatCurrency(supplier.total_sum)}</td>
                    <td>${supplier.category}</td>
                    <td><small>${supplier.purchase_method}</small></td>
                `;

                tableBody.appendChild(row);
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return (amount / 1000000000).toFixed(1) + ' –º–ª—Ä–¥ ‚Ç∏';
            } else if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + ' –º–ª–Ω ‚Ç∏';
            } else {
                return amount.toLocaleString() + ' ‚Ç∏';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
        async function updateSuppliersData() {
            const btn = document.getElementById('updateDataBtn');

            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const response = await fetch('/api/update-suppliers', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const data = await response.json();

                if (data.status === 'success') {
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    await initializeSupplierModule();
                    alert('‚úÖ ' + data.message);
                } else {
                    alert('‚ùå ' + data.message);
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
    </script>
</body>
</html>